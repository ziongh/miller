---
git:
  branch: main
  commit: 57f38e0
  dirty: true
  files_changed:
  - TODO.md
  - pyproject.toml
  - python/miller/server.py
  - .memories/2025-11-20/143714_6c59.json
  - .memories/2025-11-20/144744_f6d3.json
  - .memories/2025-11-20/144942_879b.json
  - .memories/2025-11-20/145419_b676.json
  - .memories/2025-11-20/151411_93f8.json
  - .memories/2025-11-20/153944_a1ea.json
  - .memories/plans/plan_toon-format-migration-fastsearch-pilot.json
  - python/miller/toon_types.py
  - python/tests/measure_token_reduction.py
  - python/tests/measure_trace_real_queries.py
  - python/tests/measure_trace_token_reduction.py
  - python/tests/test_fast_refs_toon.py
  - python/tests/test_fast_search_toon.py
  - python/tests/test_get_symbols_toon.py
  - python/tests/test_toon_format.py
  - python/tests/test_trace_toon.py
id: learning_d754c56f_79c714
tags:
- bugfix
- toon-format
- fast-refs
- type-mismatch
timestamp: 1763680523
type: learning
---

Fixed TOON implementation bugs in fast_refs and get_symbols. Bug 1: Incorrect parameter passing - was passing threshold as kwarg instead of ToonConfig object (fixed in fast_refs, get_symbols, trace_call_path). Bug 2: fast_refs was using encode_toon() wrapper (designed for symbol lists) instead of raw toon_encode() (works for dicts). Both tools now properly encode to TOON format. Root cause: encode_toon() expects list[dict], but fast_refs returns a single dict with nested structure.
