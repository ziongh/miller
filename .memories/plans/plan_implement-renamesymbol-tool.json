{
  "content": "# rename_symbol Tool Implementation Plan\n\n## Overview\nReplace the underused `fast_goto` with a genuinely useful `rename_symbol` tool that leverages Miller's unique advantages: tree-sitter symbol extraction, reference graph, and semantic embeddings.\n\n## Progress Summary\n**Status: Core Implementation Complete (29/29 tests passing)**\n\n---\n\n## Completed Phases\n\n### Phase 1: Contract Definition \u2705\n- Created `python/miller/tools/refactor.py` with dataclasses\n- Defined RenameEdit, RenamePreview, RenameResult, CascadeSuggestion types\n- Documented function signatures, parameters, error conditions\n\n### Phase 2: Test Suite (RED Phase) \u2705\n- Created `python/tests/test_refactor.py` with 29 comprehensive tests\n- Tests cover: validation, preview, apply, errors, word boundaries, imports, cascade\n\n### Phase 3: Core Implementation (GREEN Phase) \u2705\n- [x] `_validate_identifier()` - Python identifier validation\n- [x] `_build_edit_plan()` - Convert refs to edit plan\n- [x] `_check_name_collision()` - Detect name conflicts\n- [x] `_format_preview_as_text/json()` - Preview formatting\n- [x] `_format_result_as_text/json()` - Result formatting\n- [x] `_apply_edits()` - Word-boundary-safe file modification\n- [x] `rename_symbol()` - Main function using find_references\n- [x] `find_cascade_suggestions()` - Pattern-based related symbol discovery\n\n---\n\n## Remaining Work\n\n### Phase 4: Integration\n- [ ] Remove `fast_goto` from navigation.py\n- [ ] Remove from tools_wrappers.py\n- [ ] Remove from server.py exports\n- [ ] Add `rename_symbol` to tools_wrappers.py with @mcp.tool() decorator\n- [ ] Update instructions.md documentation\n\n### Phase 5: Future Enhancements (Noted, not blocking)\n- [ ] Qualified name scoping (UserService.save vs OrderService.save)\n- [ ] Semantic cascade suggestions using embeddings\n- [ ] Cross-language symbol correlation\n\n---\n\n## Technical Notes\n\n### Files Modified\n- `python/miller/tools/refactor.py` - New module (implementation complete)\n- `python/tests/test_refactor.py` - New test file (29 tests)\n\n### Key Design Decisions\n1. **dry_run=True by default** - Safe preview before changes\n2. **Word-boundary regex** - Prevents substring renames (e.g., \"get\" in \"get_user\")\n3. **Uses find_references** - Leverages existing reference graph\n4. **Pattern-based cascade** - Uses naming variants for related symbol discovery\n\n### Test Results\n- 29/29 rename_symbol tests passing\n- 755/755 total tests passing\n- Coverage: 80.48%\n",
  "git": {
    "branch": "main",
    "commit": "730abdf",
    "dirty": true,
    "files_changed": [
      "CLAUDE.md",
      "python/miller/lifecycle.py",
      "python/miller/reranker.py",
      "python/miller/tools/navigation.py",
      "python/miller/tools/search.py",
      "python/tests/test_fast_search_toon.py",
      "python/tests/test_reranker.py",
      "python/tests/test_search_filters.py",
      "python/tests/test_server.py",
      ".memories/2025-11-24/153258_467a.json",
      ".memories/2025-11-24/154255_570d.json",
      ".memories/2025-11-24/155624_53ff.json",
      ".memories/2025-11-24/160653_3c5b.json"
    ]
  },
  "id": "plan_implement-renamesymbol-tool",
  "status": "pending",
  "timestamp": 1764028575,
  "title": "Implement rename_symbol Tool",
  "type": "plan"
}
