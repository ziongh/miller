{
  "content": "## Goal\nOptimize Miller's performance across file discovery, database operations, and search queries before public launch.\n\n## \u2705 COMPLETED - All High Priority Items\n\n### 1. Single-Pass File Discovery \u2705\n**Files:** `python/miller/workspace/discovery.py`, `scanner.py`\n- [x] Created `scan_workspace()` function that does single walk\n- [x] Returns `WorkspaceScanResult` dataclass with: indexable_files, max_mtime, all_paths_set\n- [x] Updated `check_if_indexing_needed()` to use single scan result\n- [x] Updated `_walk_directory()` to use scan_workspace internally\n- [x] All tests pass (21 workspace tests)\n\n### 2. Batch Inserts in Atomic Update \u2705\n**Files:** `python/miller/storage/mutations.py`\n- [x] Refactored `incremental_update_atomic()` to use `executemany()` for all inserts\n- [x] Batch file inserts, symbol inserts, identifier inserts, relationship inserts\n- [x] Kept atomic transaction semantics (BEGIN IMMEDIATE...COMMIT)\n- [x] All tests pass (42 storage + workspace tests)\n\n### 3. Batch Search Hydration \u2705\n**Files:** `python/miller/tools/search.py`, `python/miller/storage/queries.py`\n- [x] Added `get_symbols_by_ids(ids: list[str])` to queries.py\n- [x] Added wrapper to StorageManager\n- [x] Refactored `_hydrate_search_results()` to use batch lookup\n- [x] Reduces 20 queries to 1 for typical search results\n- [x] All tests pass (31 fast_search_toon tests)\n\n### 4. Batch Search Expansion \u2705\n**Files:** `python/miller/tools/search.py`, `python/miller/storage/queries.py`\n- [x] Added `get_reachability_for_targets_batch()` with min_distance filtering\n- [x] Added `get_reachability_from_sources_batch()` with min_distance filtering\n- [x] Added wrappers to StorageManager\n- [x] Refactored `_expand_search_results()` to use 3 batch queries total\n- [x] Reduces ~240 queries to ~3 queries when expand=True\n- [x] All tests pass (72 search tests)\n\n### 5. Composite Reachability Indexes \u2705\n**Files:** `python/miller/storage/schema.py`\n- [x] Added `idx_reach_target_dist ON reachability(target_id, min_distance)`\n- [x] Added `idx_reach_source_dist ON reachability(source_id, min_distance)`\n- [x] Optimizes batch queries with distance filtering\n\n### 6. Batch File Cleanup \u2705\n**Files:** `python/miller/storage/mutations.py`, `scanner.py`\n- [x] Added `delete_files_batch(file_paths: list[str])` to mutations.py\n- [x] Added wrapper to StorageManager\n- [x] Updated scanner.py cleanup phase to use batch delete\n- [x] Single transaction instead of N commits\n\n## Success Metrics\n- [x] All 747 tests pass\n- [x] `check_if_indexing_needed()` now does 1 filesystem walk instead of 3\n- [x] Batch inserts use `executemany()` (10-100x faster for large files)\n- [x] Search hydration: 20 queries \u2192 1 query\n- [x] Search expansion: ~240 queries \u2192 ~3 queries\n- [x] File cleanup: N commits \u2192 1 commit\n",
  "git": {
    "branch": "main",
    "commit": "a663127",
    "dirty": false,
    "files_changed": []
  },
  "id": "plan_miller-performance-optimization-sprint",
  "status": "active",
  "timestamp": 1764098532,
  "title": "Miller Performance Optimization Sprint",
  "type": "plan"
}
